machine:
  node:
    version: 6.10.2

dependencies:

  cache_directories:
      - "node_modules"
      - "~/.npm"
      - "~/.meteor"
      - "~/.ultrawide_data"

  override:

    # Create Ultrawide working dir
    - sh /home/ubuntu/ultrawide/scripts/setup-dirs.sh

    # Install & cache Meteor
    - sh /home/ubuntu/ultrawide/scripts/install-meteor.sh

    #- curl https://install.meteor.com | /bin/sh

    # Install and cache NPM dependencies
    - npm install

    # Install chimp
    - npm install -g chimp

    # Download & cache Chimp's dependencies
    - sh /home/ubuntu/ultrawide/scripts/download-chimp-dependencies.sh

checkout:
  post:
    - git submodule update --init

test:
  override:
    # Run Meteor unit tests
    #- npm run test:unit

    # Run integration tests.  Will need a data location and the app running
    - npm run start-ci
    - npm run chimp:int_server_des

  post:
    - npm run upload-unit-results
